<!DOCTYPE html>
<head>
    <!-- THIS FILE EXISTS IN TWO PLACES. THE STORY FOR THE WORK TO CONSOLIDATE THEM IS IN WSPI-7305 -->
<!-- IF THERE IS A CHANGE BEING MADE TO THIS FILE, IT ALSO NEEDS TO BE MADE TO api_guide/_includes/head.html -->
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Describes the PKCE Flow.">
<meta name="keywords" content="OAuth2AuthorizationAuthenticationPKCE_FlowImplicit_FlowAuthorization_Code_Flowscopes,  ">
<title>OAuth2 PKCE Flow | Constant Contact Developer Portal</title>
<link rel="stylesheet" href="css/syntax.css">

<link href="https://static.ctctcdn.com/lp/fonts/whitney/whitney-current.css" rel="stylesheet" />
<link href="https://static.ctctcdn.com/h/fed-framework/1.2.0/fed.min.css" rel="stylesheet" />
<link href='css/main.css' rel='stylesheet'/>



<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="js/jquery.navgoco.min.js"></script>

<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/dompurify/3.0.5/purify.min.js" referrerpolicy="no-referrer"></script>
<script src="js/toc.js"></script>
<script src="js/customscripts.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/svg4everybody/2.1.7/svg4everybody.js"></script>

<!-- Bring in Web Component Definitions -->
<script src="https://cdn.jsdelivr.net/riot/3.2/riot+compiler.min.js"></script>
<script src="../shared_components/dev-portal-header.tag.html" type="riot/tag"></script>
<script src="../shared_components/dev-portal-footer.tag.html" type="riot/tag"></script>
<!-- Init all Web Component Definitions -->
<script>riot.mount("*")</script>

<link rel="shortcut icon" type="image/x-icon" href="https://static.ctctcdn.com/ui/images1/favicon/REBRAND_favicon.png" />

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="" href="https://constant:contact.comfeed.xml">


    <script>
        $(document).ready(function() {
            // Initialize navgoco with default options
            $(".Sidebar-nav").navgoco({
                caretHtml: '',
                accordion: true,
                openClass: 'active', // open
                save: false, // leave false or nav highlighting doesn't work right
                cookie: {
                    name: 'navgoco',
                    expires: false,
                    path: '/'
                },
                slide: {
                    duration: 0,
                    easing: 'ease'
                }
            });

            // $("#collapseAll").click(function(e) {
            //     e.preventDefault();
            //     $("#mysidebar").navgoco('toggle', false);
            // });

            // $("#expandAll").click(function(e) {
            //     e.preventDefault();
            //     $("#mysidebar").navgoco('toggle', true);
            // });

            $('.sidebar').addClass('sticky');

        });

    </script>


    

</head>
<body>
    <!-- Use custom header web component defined in sharedComponents/dev-portal-header.tag.html-->
<dev-portal-header active-id="apiGuide"></dev-portal-header>


    <!-- Tracking -->
<script type="text/javascript">
    var utag_data = {};
</script>
<script src="../shared_components/tealium.js" type="text/javascript"></script>

    <div class="fed-wrapper">

        <!-- Page Content -->
        <section class="container container--sidebar">

            <!-- Sidebar Column -->
            <div class="sidebar u-borderRight">
                











<nav>
    <ul class="Sidebar-nav List--unstyled">
        <li class="Nav-header">Constant Contact V3 API 1.0</li>
        
        
        
            
        
        <li>
            
            
            <a href="#">What's New in the V3 API</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="index.html">Release Notes</a></li>
                
                
                
                
                
                
                <li><a href="v3_features.html">Features Exclusive to the V3 API</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#" data-qe-id="docs-intro">Getting Started</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="v3_technical_overview.html">Introduction to the V3 API</a></li>
                
                
                
                
                
                
                <li><a href="developer_portal.html">Using the Developer Portal</a></li>
                
                
                
                
                
                
                <li><a href="getting_started.html">Quick Start Guide</a></li>
                
                
                
                
                
                
                <li><a href="rate_limits.html">Rate Limits</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Migrate Integrations to V3</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="migration_overview.html">Data Migration Overview</a></li>
                
                
                
                
                
                
                <li><a href="v3_v2_contact_deltas.html">Contacts V3 Changes and Migration</a></li>
                
                
                
                
                
                
                <li><a href="v3_v2_list_deltas.html">Lists V3 Changes and Migration</a></li>
                
                
                
                
                
                
                <li><a href="v3_v2_email_campaign_deltas.html">Email Campaign V3 Changes and Migration</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Application Integration</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="apps_create.html">Create a New Application Integration</a></li>
                
                
                
                
                
                
                <li><a href="auth_update_apps.html">Update Your Applications to use the New Authorization Service</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">OAuth2 Authorization</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="auth_overview.html">OAuth2 Overview</a></li>
                
                
                
                
                
                
                <li><a href="server_flow.html">OAuth2 Authorization Code Flow</a></li>
                
                
                
                
                
                
                <li class="active"><a href="pkce_flow.html">OAuth2 PKCE Flow</a></li>
                
                
                
                
                
                
                <li><a href="device_flow.html">OAuth2 Device Flow</a></li>
                
                
                
                
                
                
                <li><a href="client_flow.html">OAuth2 Implicit Flow</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">User Authorization and API Access</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="scopes.html">Authorization Scopes Overview</a></li>
                
                
                
                
                
                
                <li><a href="user_privileges.html">User Roles and Privileges Overview</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Account Services</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="account_services_overview.html">Account Services Overview</a></li>
                
                
                
                
                
                
                <li><a href="account_details_get.html">Get Account Summary Details</a></li>
                
                
                
                
                
                
                <li><a href="account_details_put.html">Put Account Summary Details</a></li>
                
                
                
                
                
                
                <li><a href="account_address_get.html">Get Account Physical Address</a></li>
                
                
                
                
                
                
                <li><a href="account_address_put.html">Put Account Physical Address</a></li>
                
                
                
                
                
                
                <li><a href="account_post_emails.html">Add an Account Email Address</a></li>
                
                
                
                
                
                
                <li><a href="account_get_emails.html">Get a Collection of Account Emails</a></li>
                
                
                
                
                
                
                <li><a href="account_get_privileges.html">Get User Privileges</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Bulk Activity Endpoints</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="bulk_activities.html">Bulk Activity Overview</a></li>
                
                
                
                
                
                
                <li><a href="activity_status.html">Get the Status of a Bulk Activity</a></li>
                
                
                
                
                
                
                <li><a href="import_contacts.html">Import Contacts</a></li>
                
                
                
                
                
                
                <li><a href="export_contacts.html">Export Contacts to a CSV File</a></li>
                
                
                
                
                
                
                <li><a href="deleting_contacts.html">Delete Contacts Bulk Activity</a></li>
                
                
                
                
                
                
                <li><a href="add_list_membership.html">Add Contacts to Lists Bulk Activity</a></li>
                
                
                
                
                
                
                <li><a href="remove_list_membership.html">Remove Contacts from Lists Bulk Activity</a></li>
                
                
                
                
                
                
                <li><a href="delete_lists.html">Delete Lists Bulk Activity</a></li>
                
                
                
                
                
                
                <li><a href="delete_custom_fields_activity.html">Delete Custom Fields Bulk Activity</a></li>
                
                
                
                
                
                
                <li><a href="add_tagging_activity.html">Add Tags to Contacts Bulk Activity</a></li>
                
                
                
                
                
                
                <li><a href="remove_tagging_activity.html">Remove Tags from Contacts Bulk Activity</a></li>
                
                
                
                
                
                
                <li><a href="delete_tagging_activity.html">Delete Tags Bulk Activity</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Contacts</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="contacts_overview.html">Contacts Overview</a></li>
                
                
                
                
                
                
                <li><a href="contacts_subresources.html">Contact Subresources</a></li>
                
                
                
                
                
                
                <li><a href="contacts_create.html">Create a Contact</a></li>
                
                
                
                
                
                
                <li><a href="contacts_create_or_update.html">Create or Update a Contact Using a Single Method</a></li>
                
                
                
                
                
                
                <li><a href="contacts_counts.html">Get Contact Consent Counts</a></li>
                
                
                
                
                
                
                <li><a href="contacts_autoresponder.html">Autoresponder and Confirmed Opt-in Emails</a></li>
                
                
                
                
                
                
                <li><a href="contacts_delete.html">Delete a Contact</a></li>
                
                
                
                
                
                
                <li><a href="contacts_sync.html">Sync Contacts and Lists</a></li>
                
                
                
                
                
                
                <li><a href="contacts_re-subscribe.html">Unsubscribe and Resubscribe Contacts</a></li>
                
                
                
                
                
                
                <li><a href="contacts_sms_engagement.html">Get Contact SMS Engagement History</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Contact Custom Fields</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="custom_fields.html">Custom Fields Overview</a></li>
                
                
                
                
                
                
                <li><a href="create_custom_fields.html">Create and Update Custom Fields</a></li>
                
                
                
                
                
                
                <li><a href="get_custom_fields.html">Get Custom Fields</a></li>
                
                
                
                
                
                
                <li><a href="delete_custom_fields.html">Delete a Custom Field</a></li>
                
                
                
                
                
                
                <li><a href="add_custom_field_data.html">Add Custom Fields to Contacts</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Contact Lists</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="lists_overview.html">Contact Lists Overview</a></li>
                
                
                
                
                
                
                <li><a href="lists_get_single.html">Get a Contact List</a></li>
                
                
                
                
                
                
                <li><a href="lists_get_all.html">Get All Contact Lists</a></li>
                
                
                
                
                
                
                <li><a href="lists_post.html">Create a Contact List</a></li>
                
                
                
                
                
                
                <li><a href="lists_put.html">Update a Contact List</a></li>
                
                
                
                
                
                
                <li><a href="lists_delete.html">Delete a Contact List</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Contact Tags</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="tags_overview.html">Tags Overview</a></li>
                
                
                
                
                
                
                <li><a href="tags_get_single.html">Get a Tag's Details</a></li>
                
                
                
                
                
                
                <li><a href="tags_get.html">Get Details about all Tags</a></li>
                
                
                
                
                
                
                <li><a href="tags_create.html">Create a Tag</a></li>
                
                
                
                
                
                
                <li><a href="tags_update.html">Rename a Tag</a></li>
                
                
                
                
                
                
                <li><a href="tags_delete.html">Delete a Tag</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Contact Reporting</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="contact_reporting_overview.html">Contact Reporting Overview</a></li>
                
                
                
                
                
                
                <li><a href="activities_summary.html">Get Activity Summary</a></li>
                
                
                
                
                
                
                <li><a href="activity_details.html">Get Activity Details</a></li>
                
                
                
                
                
                
                <li><a href="open_and_click_rates.html">Get Open and Click Rates</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Email Campaigns</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="email_campaigns_overview.html">Email Campaigns Overview</a></li>
                
                
                
                
                
                
                <li><a href="email_campaign_create.html">Create an Email Campaign</a></li>
                
                
                
                
                
                
                <li><a href="design_code_emails.html">Designing HTML for Custom Code Emails</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_collection.html">Get a Collection of Email Campaigns</a></li>
                
                
                
                
                
                
                <li><a href="email_campaign_id.html">Get Email Campaign Details for a Single Email Campaign</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_activity_id.html">Get an Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="email_campaign_activity_update.html">Update an Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="email_campaign_create_schedule.html">Schedule an Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_activity_get_schedules.html">Get the Schedule of an Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="email_campaign_activity_delete_schedule.html">Unschedule an Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="email_campaign_activity_preview.html">Get an HTML Preview of an Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="email_campaign_activity_test_send.html">Test Send an Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_rename.html">Rename an Existing Email Campaign</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_sends_history.html">Get Send History Details for Email Campaign Activities</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_delete.html">Delete an Email Campaign</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_resend_non_openers_post.html">Post (Schedule) a Resend to Non-openers Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_resend_non_openers_get.html">Get Details for a Resend to Non-openers Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_resend_non_openers_delete.html">Delete (Unschedule) a Resend to Non-openers Email Campaign Activity</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Email Campaigns A/B Tests</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="email_campaigns_ab_test_overview.html">Email Campaign Activities A/B Tests Overview</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_ab_test_get.html">Get A/B Test Details for a Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="email_campaigns_ab_test_post.html">Create an A/B Test for a Email Campaign Activity</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_campaigns_ab_test_delete.html">Delete an A/B Test for a Email Campaign Activity</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Email Reporting</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="email_reporting_overview.html">Email Reporting Overview</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_summary_sends_report.html">Get an Email Sends Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_summary_opens_report.html">Get an Email Opens Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_summary_unique_opens_report.html">Get an Email Unique Opens Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_summary_clicks_report.html">Get an Email Clicks Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_summary_non_opens_report.html">Get an Email Did Not Opens Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_summary_forwards_report.html">Get an Email Forwards Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_summary_optouts_report.html">Get an Email Opt-outs Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_links_report.html">Get an Email Link Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_summary_bounces_report.html">Get an Email Bounces Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_campaign_stats_report.html">Get an Email Campaign Stats Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_campaign_activities_stats_report.html">Get an Email Campaign Activities Stats Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/email_bulk_campaign_summary_report.html">Get an Email Campaigns Summary Report</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Segments</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/segments_overview.html">Segments Overview</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/segment_create.html">Create a Segment</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/segment_get_all.html">Get all Segments</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/segment_get.html">Get a Segment's Details</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/segment_delete.html">Delete a Segment</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/segment_update.html">Update a Segment</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/segment_rename.html">Rename a Segment</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Landing Page Reports</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/lp_reports_overview.html">Overview</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/lp_reports_unique_contact_clicks.html">Get a Unique Contacts Clicks Landing Page Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/lp_reports_contact_opens.html">Get all Contact Opens Landing Page Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/lp_reports_unique_contact_opens.html">Get a Unique Contacts Opens Landing Page Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/lp_reports_unique_contact_adds.html">Get a Unique Contact Adds Landing Page Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/lp_reports_unique_contact_sms_optins.html">Get a Unique Contact SMS Opt-in Opens Landing Page Report</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/lp_reports_unique_contact_updates.html">Get a Unique Contact Updates Landing Page Report</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Technology Partners</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partners_overview.html">Technology Partner Overview</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partners_dev_accts.html">Signup for a Technology Partner Developer Account</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partners_reg_creds.html">Technology Partner Registration</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partners_auth.html">Technology Partner Authentication</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partner_sso_config.html">Configuring Single Sign On</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partners_accts_create.html">Create a Partner Client Account</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partners_accts_get.html">Get all Partner Client Accounts</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partners_plans_get.html">Get Billing Plan Details for a Client Account</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partners_plans_update.html">Update the Billing Plan for a Client Account</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partners_plans_cancel.html">Cancel the Billing Plan for a Client Account</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partners_master_token.html">Send API Requests on Behalf of Managed Client Accounts</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">Technology Partner Webhooks</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/partner_webhook_overview.html">Partner Webhooks Overview</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/webhook_single.html">Get a Partner Webhook</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/webhook_collection.html">Get all Partner Webhooks</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/webhook_put.html">Subscribe (PUT) to a Partner Webhook</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/webhook_delete.html">Unsubscribe (Delete) a Partner Webhook</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/webhooks_post.html">Test (POST) Webhook Subscriptions</a></li>
                
                
                
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/webhook_authenticity.html">Webhook Authenticity</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">HTTP Status Response Codes</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/glossary_responses.html">Response Codes</a></li>
                
                
                
                
            </ul>
            
            
        
        <li>
            
            
            <a href="#">V3 API Schema</a>
            
            
            <ul class="List--unstyled">
                
                
                
                <li><a href="https://developer.constantcontact.com/api_guide/v3api_schema.html">V3 API Schema Download</a></li>
                
                
                
                
            </ul>
            
            
            
            <!-- if you aren't using the accordion, uncomment this block:
               <p class="external">
                   <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
               </p>
               -->
        </li>
    </ul>
</nav>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

            </div>

            <!-- Content Column -->
            <div class="content">
                <div class="inner">
                    <div class="post-header">
   <h1 class="post-title-main">OAuth2 PKCE Flow</h1>
</div>



<div class="post-content">

   
    <div class="summary">Describes the PKCE Flow.</div>
   

    
    
<!-- this handles the automatic toc. use ## for subheads to auto-generate the on-page minitoc. if you use html tags, you must supply an ID for the heading element in order for it to appear in the minitoc. -->
<script>
$( document ).ready(function() {
  // Handler for .ready() called.
$('#toc').toc({ minimumHeaders: 0, listType: 'ul', showSpeed: 0, headers: 'h1,h2,h3,h4' });

/* this offset helps account for the space taken up by the floating toolbar. */
$('#toc').on('click', 'a', function() {
  var target = DOMPurify.sanitize(this.getAttribute('href')),
      scroll_target = document.getElementById(target).offset().top

  $('html, body').scrollTop(scroll_target - 41);
  return false
})
  
});
</script>

<div id="toc" class="Well toc"></div>

    

  <p>Constant Contact strongly suggests that you use the Proof Key for Code Exchange (PKCE) Flow for all public or untrusted clients. This includes native and single-page applications such as client-side JavaScript applications and mobile applications. PKCE is an OAuth2 security extension that builds upon the standard Authorization Code Flow. The PKCE Flow is used to prevent malicious attacks on applications that cannot securely store a client secret.</p>

<p>In order to use this flow, you must first create and configure a V3 API application. For more information, see the <a href="apps_create.html">Create an Application Integration</a>.</p>

<p>The PKCE Flow does not use the client secret key to authenticate. Instead, your application generates the following values to use:</p>
<ol>
  <li><code class="highlighter-rouge">code_verifier</code> - A random cryptographic value to include in the authorization request.</li>
  <li><code class="highlighter-rouge">code_challenge</code> - A SHA-256 hash of the <code class="highlighter-rouge">code_verifier</code> value used in exchange for an access token (Bearer).</li>
</ol>

<p>The Authorization Server stores the <code class="highlighter-rouge">code_challenge</code> and uses your application’s authorization request to redirect the user to log in to authenticate with Constant Contact and to grant your application permission to their data.  If successful, the Authorization Server responds and sends your client the authorization <code class="highlighter-rouge">code</code>, which is valid for one use.</p>

<p>Your application sends a verification request that includes both the authorization <code class="highlighter-rouge">code</code> and the <code class="highlighter-rouge">code_verifier</code> to the Authorization Server. The Authorization Server checks that the authorization <code class="highlighter-rouge">code</code> and <code class="highlighter-rouge">code_verifier</code> are valid for the user, then returns the ID token, access token, and optionally the refresh token that your application requires to make V3 API calls to get the user’s Constant Contact data. Use the access token to make requests using the V3 API. Use refresh tokens to obtain new access and refresh tokens to ensure that your users only need to authenticate once.</p>

<p>To authenticate using the PKCE Flow, complete the steps that follow.</p>

<h1 id="step-1-generate-a-code-verifier-and-a-code-challenge">Step 1: Generate a Code Verifier and a Code Challenge</h1>

<p>Using the PKCE Flow, you must create the cryptographically-random <code class="highlighter-rouge">code_verifier</code> value. Use SHA-256 to hash the <code class="highlighter-rouge">code_verifier</code> value as the <code class="highlighter-rouge">code_challenge</code> value.</p>

<h2 id="generate-the-code-verifier">Generate the Code Verifier</h2>

<p>Generate a <code class="highlighter-rouge">code_verifier</code> value in your application and save it. The <code class="highlighter-rouge">code_verifier</code> should be a cryptographical value and have a minimum length of 43 characters and a maximum length of 128 characters. Later, you will use this value when:</p>
<ul>
  <li>Generating a <code class="highlighter-rouge">code_challenge</code> value.</li>
  <li>Exchanging an authorization <code class="highlighter-rouge">code</code> for an access token.</li>
</ul>

<p>For example:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">   </span><span class="err">/**</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">method</span><span class="w"> </span><span class="err">generates</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">secure</span><span class="w"> </span><span class="err">string</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">PKCE</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">verifier</span><span class="w"> </span><span class="err">value.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">In</span><span class="w"> </span><span class="err">PKCE,</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">verifier</span><span class="w"> </span><span class="err">value:</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="mi">1</span><span class="err">.</span><span class="w"> </span><span class="err">When</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">generate</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">challenge</span><span class="w"> </span><span class="err">value.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="mi">2</span><span class="err">.</span><span class="w"> </span><span class="err">When</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">exchange</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">authorization</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">bearer</span><span class="w"> </span><span class="err">JWT</span><span class="w"> </span><span class="err">token.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@return</span><span class="w"> </span><span class="err">A</span><span class="w"> </span><span class="err">random</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">verifier</span><span class="w"> </span><span class="err">value.</span><span class="w">
     </span><span class="err">*/</span><span class="w">
    </span><span class="err">public</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">generateCodeVerifier()</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">SecureRandom</span><span class="w"> </span><span class="err">secureRandom</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">SecureRandom();</span><span class="w">
        </span><span class="err">byte</span><span class="p">[]</span><span class="w"> </span><span class="err">bytes</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">byte</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span><span class="err">;</span><span class="w">
        </span><span class="err">secureRandom.nextBytes(bytes);</span><span class="w">

        </span><span class="err">return</span><span class="w"> </span><span class="err">Base</span><span class="mi">64</span><span class="err">.getUrlEncoder().withoutPadding().encodeToString(bytes);</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="generate-the-code-challenge">Generate the Code Challenge</h2>

<p>Generate a <code class="highlighter-rouge">code_challenge</code> value in your application and save it. The <code class="highlighter-rouge">code_challenge</code> value is derived from your <code class="highlighter-rouge">code_verifier</code> value. Generate the <code class="highlighter-rouge">code_challenge</code> value by using SHA-256 to hash the <code class="highlighter-rouge">code_verifier</code> value, then base64 URL encode the results.</p>

<p>For example:
<code class="highlighter-rouge">code_challenge = BASE64URL-ENCODE(SHA256(ASCII(code_verifier)))</code></p>

<p>For more details, see the <a href="https://tools.ietf.org/html/rfc7636">Proof Key for Code Exchange by OAuth Public Clients</a> sections of RFC 7636.</p>

<p>The following example shows how to create a <code class="highlighter-rouge">code_challenge</code> value using SHA-256 to base64 encode the <code class="highlighter-rouge">code_verifier</code> value:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="err">/**</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">method</span><span class="w"> </span><span class="err">generates</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">challenge</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">by</span><span class="w"> </span><span class="err">SHA</span><span class="mi">-256</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">base</span><span class="mi">64</span><span class="w"> </span><span class="err">encoding</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">verifier</span><span class="w"> </span><span class="err">value.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">In</span><span class="w"> </span><span class="err">PKCE,</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">challenge</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">when</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">construct</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">authorization</span><span class="w"> </span><span class="err">request</span><span class="w"> </span><span class="err">uri.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">codeVerifierValue</span><span class="w"> </span><span class="err">A</span><span class="w"> </span><span class="err">random</span><span class="w"> </span><span class="err">string</span><span class="w"> </span><span class="err">value.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@return</span><span class="w"> </span><span class="err">An</span><span class="w"> </span><span class="err">encoded</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">challenge</span><span class="w"> </span><span class="err">string</span><span class="w"> </span><span class="err">value.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@throws</span><span class="w"> </span><span class="err">NoSuchAlgorithmException</span><span class="w">
     </span><span class="err">*/</span><span class="w">
    </span><span class="err">public</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">generateCodeChallengeHash(String</span><span class="w"> </span><span class="err">codeVerifierValue)</span><span class="w"> </span><span class="err">throws</span><span class="w"> </span><span class="err">NoSuchAlgorithmException</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">MessageDigest</span><span class="w"> </span><span class="err">messageDigest</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">MessageDigest.getInstance(</span><span class="s2">"SHA-256"</span><span class="err">);</span><span class="w">
        </span><span class="err">byte</span><span class="p">[]</span><span class="w"> </span><span class="err">codeVerifierBytes</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">codeVerifierValue.getBytes(StandardCharsets.US_ASCII);</span><span class="w">
        </span><span class="err">byte</span><span class="p">[]</span><span class="w"> </span><span class="err">digest</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">messageDigest.digest(codeVerifierBytes);</span><span class="w">

        </span><span class="err">return</span><span class="w"> </span><span class="err">Base</span><span class="mi">64</span><span class="err">.getUrlEncoder().withoutPadding().encodeToString(digest);</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h1 id="step-2-create-the-authorization-request">Step 2: Create the Authorization Request</h1>

<p>Create the authorization request used to direct users to Constant Contact to authenticate their user account and to authorize your application to access their Constant Contact data.</p>

<p>To create an authorization request, use the authorization endpoint <strong><code class="highlighter-rouge">https://authz.constantcontact.com/oauth2/default/v1/authorize</code></strong> and include all required request query parameters.</p>

<p>For example, the following shows an encoded URL authorization request:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>https://authz.constantcontact.com/oauth2/default/v1/authorize?client_id={your_client_id}&amp;redirect_uri=https%3A%2F%2Flocalhost%3A8888&amp;&amp;response_type=code&amp;code_challenge={generated code_challenge value}&amp;code_challenge_method={S256}&amp;state=235o250eddsdff&amp;scope={contact_data%20campaign_data%20offline_access}

</code></pre></div></div>

<p><strong>Request Parameters</strong></p>

<ul>
  <li>
    <p><strong><code class="highlighter-rouge">code_challenge</code></strong> - <em>Required</em>. The <code class="highlighter-rouge">code_challenge</code> value generated by your application.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">code_challenge_method</code></strong> - <em>Required</em>. The hashing algorithm you used to generate the <code class="highlighter-rouge">code_challenge</code>. This value should always be SHA-256.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">client_id</code></strong> — <em>Required</em>. The API key for your application. You can view the API keys for all of your applications or create a new application on the <a href="https://app.constantcontact.com/pages/dma/portal/" target="_blank">My Applications</a> page.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">redirect_uri</code></strong> — <em>Required</em>. Specify the absolute URI that you want Constant Contact to use when redirecting a user to your application. After a user authorizes your application, Constant Contact redirects the user to your application and appends the authorization <code class="highlighter-rouge">code</code> and <code class="highlighter-rouge">state</code> (and optionally the <code class="highlighter-rouge">scope</code>) values to the URI as query parameters. Wildcards are not supported except at the domain root level. For more information, see the <a href="https://v3.developer.constantcontact.com/api_guide/auth_overview.html" target="_blank">Authentication Overview</a> page.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">response_type</code></strong> — <em>Required</em>. This flow uses <code class="highlighter-rouge">code</code> as the value to request an authorization code from Constant Contact.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">state</code></strong> - <em>Required</em>. To prevent cross-site request forgery, specify the arbitrary <code class="highlighter-rouge">state</code> string value you want to use to uniquely identify a user’s session.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">scope</code></strong> — <em>Optional</em>. A list of the scopes that your application requires. The V3 API currently supports the <code class="highlighter-rouge">account_read</code>, <code class="highlighter-rouge">account_update</code>, <code class="highlighter-rouge">contact_data</code>, <code class="highlighter-rouge">offline_access</code>, and <code class="highlighter-rouge">campaign_data</code> scopes. Scope names must be space-delimited. For example: <code class="highlighter-rouge">{contact_data%20campaign_data%20offline_access}</code>.</p>

    <p>The <code class="highlighter-rouge">offline_access</code> scope is required for returning refresh tokens. For more information on scopes and the specific scopes required by each V3 API endpoint, see the <a href="scopes.html">Scopes Overview</a> page.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">nonce</code></strong> — <em>Optional</em>. For the purpose of mitigating replay attacks, specify the string value to use to associate a client session with an <code class="highlighter-rouge">id_token</code>. The <code class="highlighter-rouge">id_token</code> includes information (claims) about the user and, if specified, the nonce value. The <code class="highlighter-rouge">id_token</code> is encoded as a JWT and returned in the response when you request an access token. To verify the nonce string value, decode the <code class="highlighter-rouge">id_token</code>.</p>
  </li>
</ul>

<p><strong>Example Authorization Request</strong></p>

<div class="Tab js-tab" data-qe-id="Tab-ID">
   <a href="#JAVA" data-qe-id="Tab-ID-OPTION2">JAVA</a>
 </div>
<div class="TabContent">

<div id="JAVA">

    <div class="language-java highlighter-rouge"><div class="highlight"><pre class="highlight"><code> <span class="cm">/**
     * Use the URIBuilder from org.apache.http to construct an authorization request URI.
     * @param codeChallengeValue The code challenge value that your application encoded.
     * @param redirectUri URI used to redirect users to your application after they complete authorization.
     * @param clientId Your application's client id.
     * @param state A random string value used to help protect your application from cross-site request forgery.
     * @return The full authorization URI
     * @throws URISyntaxException
     */</span>
    <span class="kd">public</span> <span class="nc">String</span> <span class="nf">constructAuthorizationUri</span><span class="o">(</span><span class="nc">String</span> <span class="n">codeChallengeValue</span><span class="o">,</span> <span class="nc">String</span> <span class="n">redirectUri</span><span class="o">,</span> <span class="nc">String</span> <span class="n">clientId</span><span class="o">,</span> <span class="nc">String</span> <span class="n">state</span><span class="o">)</span> <span class="kd">throws</span> <span class="nc">URISyntaxException</span> <span class="o">{</span>
        <span class="k">return</span> <span class="k">new</span> <span class="nf">URIBuilder</span><span class="o">(</span><span class="s">"https://authz.constantcontact.com/oauth2/default/v1/authorize"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="s">"client_id"</span><span class="o">,</span> <span class="n">clientId</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="s">"redirect_uri"</span><span class="o">,</span> <span class="n">redirectUri</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="s">"scope"</span><span class="o">,</span> <span class="s">"offline_access openid"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="s">"response_type"</span><span class="o">,</span> <span class="s">"code"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="s">"state"</span><span class="o">,</span> <span class="n">state</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="s">"code_challenge"</span><span class="o">,</span> <span class="n">codeChallengeValue</span><span class="o">)</span>
                <span class="o">.</span><span class="na">addParameter</span><span class="o">(</span><span class="s">"code_challenge_method"</span><span class="o">,</span> <span class="s">"S256"</span><span class="o">)</span>
                <span class="o">.</span><span class="na">build</span><span class="o">()</span>
                <span class="o">.</span><span class="na">toString</span><span class="o">();</span>
    <span class="o">}</span>
</code></pre></div>    </div>

  </div>
</div>

<h1 id="step-3-get-authorization">Step 3: Get Authorization</h1>

<p>When your application sends an authorization request to the Authorization Server, it directs the user to Constant Contact. Constant Contact prompts the user to sign in to authenticate their user account. Next, Constant Contact displays the <strong>Permission Request</strong> screen to allow the user to authorize your application access to their data.</p>

<figure><img class="docimage" src="https://developer.constantcontact.com/api_guide/images/scoperequest2.png" alt="User Permission Request Screen" /></figure>

<p>If the user authorizes your application, Constant Contact appends the authorization <code class="highlighter-rouge">code</code> to the <code class="highlighter-rouge">redirect_uri</code> returned in the authorization response. The authorization <code class="highlighter-rouge">code</code> is used in exchange for an access token and can be used once.</p>

<h1 id="step-4-get-the-access-and-refresh-tokens">Step 4: Get the Access and Refresh Tokens</h1>

<p>To request an <code class="highlighter-rouge">access_token</code> and <code class="highlighter-rouge">refresh_token</code>, make a <code class="highlighter-rouge">POST</code> request to the Authorization Server using the <code class="highlighter-rouge">https://authz.constantcontact.com/oauth2/default/v1/token</code> endpoint.</p>

<p><strong>Query Parameters</strong>
Include the following required query parameters:</p>

<ul>
  <li><code class="highlighter-rouge">client_id</code> - The ID that is associated with your application.</li>
  <li><code class="highlighter-rouge">redirect_uri</code> - The redirect URI that you specified as part of the authorization request.</li>
  <li><code class="highlighter-rouge">code</code> - The authorization code returned in the authorization response.</li>
  <li><code class="highlighter-rouge">code_verifier</code> - The code verifier value that you generated.</li>
</ul>

<p><strong>Header Formats</strong></p>

<p>In the header, specify the preferred response formats to return as follows:</p>
<ul>
  <li><code class="highlighter-rouge">"Accept", "application/json"</code></li>
  <li><code class="highlighter-rouge">"Content-Type", "application/x-www-form-urlencoded"</code></li>
</ul>

<p><strong>Example Request</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="err">/**</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">method</span><span class="w"> </span><span class="err">exchanges</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">authorization</span><span class="w"> </span><span class="err">code,</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">codeVerifier</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">previous</span><span class="w"> </span><span class="err">generated,</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">access</span><span class="w"> </span><span class="err">token</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">refresh</span><span class="w"> </span><span class="err">token.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">clientId</span><span class="w"> </span><span class="err">Your</span><span class="w"> </span><span class="err">application's</span><span class="w"> </span><span class="err">client</span><span class="w"> </span><span class="err">id.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">redirectUri</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">redirect</span><span class="w"> </span><span class="err">uri</span><span class="w"> </span><span class="err">that</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">as</span><span class="w"> </span><span class="err">part</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">authorization</span><span class="w"> </span><span class="err">request</span><span class="w"> </span><span class="err">URL.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">authorization</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">received</span><span class="w"> </span><span class="err">from</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">authorization</span><span class="w"> </span><span class="err">request.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">codeVerifier</span><span class="w"> </span><span class="err">The</span><span class="w"> </span><span class="err">random</span><span class="w"> </span><span class="err">code</span><span class="w"> </span><span class="err">verifier</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">you</span><span class="w"> </span><span class="err">generated.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@return</span><span class="w"> </span><span class="err">A</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">containing</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">access</span><span class="w"> </span><span class="err">token</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">refresh</span><span class="w"> </span><span class="err">token.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@throws</span><span class="w"> </span><span class="err">IOException</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@throws</span><span class="w"> </span><span class="err">URISyntaxException</span><span class="w">
     </span><span class="err">*/</span><span class="w">
    </span><span class="err">public</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">exchangeCodeAndVerifierForAuthResponse(String</span><span class="w"> </span><span class="err">clientId,</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">redirectUri,</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">code,</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">codeVerifier)</span><span class="w"> </span><span class="err">throws</span><span class="w"> </span><span class="err">IOException,</span><span class="w"> </span><span class="err">URISyntaxException</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">URI</span><span class="w"> </span><span class="err">pkceTokenUri</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">URIBuilder(</span><span class="s2">"https://authz.constantcontact.com/oauth2/default/v1/token"</span><span class="err">)</span><span class="w">
                </span><span class="err">.addParameter(</span><span class="s2">"client_id"</span><span class="p">,</span><span class="w"> </span><span class="err">clientId)</span><span class="w">
                </span><span class="err">.addParameter(</span><span class="s2">"redirect_uri"</span><span class="p">,</span><span class="w"> </span><span class="err">redirectUri)</span><span class="w">
                </span><span class="err">.addParameter(</span><span class="s2">"code"</span><span class="p">,</span><span class="w"> </span><span class="err">code)</span><span class="w">
                </span><span class="err">.addParameter(</span><span class="s2">"code_verifier"</span><span class="p">,</span><span class="w"> </span><span class="err">codeVerifier)</span><span class="w">
                </span><span class="err">.addParameter(</span><span class="s2">"grant_type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"authorization_code"</span><span class="err">)</span><span class="w">
                </span><span class="err">.build();</span><span class="w">

        </span><span class="err">HttpClient</span><span class="w"> </span><span class="err">httpClient</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">HttpClient.newHttpClient();</span><span class="w">
        </span><span class="err">HttpRequest</span><span class="w"> </span><span class="err">request</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">HttpRequest.newBuilder(pkceTokenUri)</span><span class="w">
                </span><span class="err">.POST(HttpRequest.BodyPublishers.ofString(</span><span class="s2">""</span><span class="err">))</span><span class="w">
                </span><span class="err">.header(</span><span class="s2">"Accept"</span><span class="p">,</span><span class="w"> </span><span class="s2">"application/json"</span><span class="err">)</span><span class="w">
                </span><span class="err">.header(</span><span class="s2">"Content-Type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"application/x-www-form-urlencoded"</span><span class="err">)</span><span class="w">
                </span><span class="err">.build();</span><span class="w">

        </span><span class="err">HttpResponse&lt;String&gt;</span><span class="w"> </span><span class="err">httpResponse</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">httpClient.send(request</span><span class="p">,</span><span class="w"> </span><span class="err">HttpResponse.BodyHandlers.ofString());</span><span class="w">
        
        </span><span class="err">return</span><span class="w"> </span><span class="err">httpResponse.body();</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p><strong>Example Response</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="mi">28800</span><span class="p">,</span><span class="w">
    </span><span class="nl">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJraWQiOiIzSDdLVVpkSDlyNTh6RVVDSzNYMlR1b2o0SjV0eldWUF9FRUxQTDd6X3hjIiwiYWxnIjoiUlMyNTYifQ.eyJ2ZXIiOjEsImp0aSI6IkFULkZ6YUUtTVFFb2dKQ1VzZlhSUGtBZldobDllckJndVlYRWphOGFXd1RyRzgiLCJpc3MiOiJodHRwczovL2lkZW50aXR5LmNvbnN0YW50Y29udGFjdC5jb20vb2F1dGgyL2F1czFsbTNyeTltRjd4MkphMGg4IiwiYXVkIjoiaHR0cHM6Ly9hcGkuY2MuZW1haWwvdjMiLCJpYXQiOjE2NDQ0Mjc3NzMsImV4cCI6MTY0NDQ1NjU3MywiY2lkIjoiY2M5NGMyZDYtNmU3MC00MjZjLWFmZDEtNzFjOGZhNWY0ODkwIiwidWlkIjoiMDB1MWlieDhsaGIzYW12SFIwaDgiLCJzY3AiOlsiYWNjb3VudF9yZWFkIiwiZW1haWwiLCJjYW1wYWlnbl9kYXRhIiwicHJvZmlsZSIsImFkZHJlc3MiLCJjb250YWN0X2RhdGEiLCJvcGVuaWQiXSwic3ViIjoiZ2Vla3NxdWFkIiwicGxhdGZvcm1fdXNlcl9pZCI6ImQzYTA2ZTYyLTJmMTQtNGQ5Ni05NDUzLTI2NTkxYWI1M2YwZCJ9.saJxgUYx1_OKUteH01KV71vzjaxqTKnZ3XfD4QKtsIkjrmcf4tUWEFSzjuF1kdxLvlMoCyr_MwO81ApwYX2UU0YRhkVsfw2VLR4KpO89ILul7ZJZyzzsVKak8BrgLhqR1AB7X116VRjsH74vD4D-1e4uKKUlK4yefsZE14kFgDZNi74_WPn5FBGeicwMsStdG3qms8X-6LqIxuZ5fXgSxK9wDEBe-xJfJSqAqo1vJKMqw2JT_NvBBLDXqoSg0_q_0IqbxXEMHdX2J_DHGKrY7w1QQGmeBU_BIlewQPUxUGX-dbRavxncBpItt1tsRLBIiPbPkQ_zDN8_J9lPIxJksA"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account_read offline_access"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"HFsqfgtZuGyffnD2qb-AQKWDURWAXM8hlgYIFEwaq4E"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"id_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIwMDEyMzQ1ejRXMzhHS3BPMGg3IiwibmFtZSI6IkpvaG4gRG9lIiwiZW1haWwiOiJqZG9lQGFiYy5jb20iLCJ2ZXIiOjEsImlzcyI6Imh0dHBzOi8vaWRlbnRpdHkuY29uc3RhbnRjb250YWN0LmNvbS9vYXV0aDIvYXVzengwNm81alJlZlE4RjQwaDciLCJhdWQiOiJmYThhMDZkYy1iMDAwLTQ3NWMtYWNlZC01NWNlYzVhZWUzMjUiLCJpYXQiOjE2NDQ4NTc4NDcsImV4cCI6MTY0NDg2MTQ0NywianRpIjoiSUQuRFhRQ2pxQmd3M28xMnVHdlN5R2ZpQTJ2QjVFcGNvSktsajBqbFhSc2lqayIsImFtciI6WyJwd2QiXSwiaWRwIjoiMDBvbnBtc2prYmdPc0wydlcwaDciLCJub25jZSI6Ijg2MDgyNTYwMyIsInByZWZlcnJlZF91c2VybmFtZSI6Impkb2UiLCJhdXRoX3RpbWUiOjE2NDQ4NTc4NDQsImF0X2hhc2giOiJuWk5sRjduWGo2bV9UNEFKcXl0c1RRIn0.ToO_Ye1YHRx4hWCMBnrT6yksWvkrpHfGmXcHTh7B75A"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<ul>
  <li>
    <p><code class="highlighter-rouge">token_type</code> — This value is always set to <code class="highlighter-rouge">Bearer</code>.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">expires_in</code> — The number of seconds remaining until the <code class="highlighter-rouge">access_token</code> expires.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">access_token</code> — The new <code class="highlighter-rouge">access_token</code> value used to send requests with the V3 API. Access tokens automatically expire 1440 minutes (86,400 seconds). Making an API call with an expired access token returns a 401 unauthorized status code.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">scope</code> — The type of data in Constant Contact that the user is granting your application permission to use. The <code class="highlighter-rouge">offline_access</code> scope is required to get a refresh token.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">refresh_token</code> — Each refresh token corresponds to an access token. Use the refresh token to obtain a new <code class="highlighter-rouge">access_token</code> when the corresponding <code class="highlighter-rouge">access_token</code> expires.</p>
  </li>
  <li>
    <p><code class="highlighter-rouge">id_token</code> — The JWT that includes information about the user such as their name and email address, and if specified, the <code class="highlighter-rouge">nonce</code> value you passed in the authorization request. Decode the <code class="highlighter-rouge">id_token</code> to verify the nonce value and view user information.</p>
  </li>
</ul>

<h1 id="step-5-validate-the-access-token">Step 5: Validate the Access Token</h1>

<p>For each new access token that you receive, follow best practices for security by validating the signature and claims of the access token.</p>

<h2 id="load-the-json-web-key-set">Load the JSON web-key Set</h2>

<p>Use the method that follows to load the Constant Contact public json web-key set used to validate access tokens.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w"> </span><span class="err">/**</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">method</span><span class="w"> </span><span class="err">uses</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">java</span><span class="mi">11</span><span class="w"> </span><span class="err">http</span><span class="w"> </span><span class="err">client</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">load</span><span class="w"> </span><span class="err">Constant</span><span class="w"> </span><span class="err">Contact's</span><span class="w"> </span><span class="err">public</span><span class="w"> </span><span class="err">json</span><span class="w"> </span><span class="err">web</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">set.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">In</span><span class="w"> </span><span class="err">real</span><span class="w"> </span><span class="err">use</span><span class="w"> </span><span class="err">cases,</span><span class="w"> </span><span class="err">this</span><span class="w"> </span><span class="err">value</span><span class="w"> </span><span class="err">should</span><span class="w"> </span><span class="err">be</span><span class="w"> </span><span class="err">cached.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@return</span><span class="w"> </span><span class="err">Constant</span><span class="w"> </span><span class="err">Contact's</span><span class="w"> </span><span class="err">public</span><span class="w"> </span><span class="err">json</span><span class="w"> </span><span class="err">web</span><span class="w"> </span><span class="err">key</span><span class="w"> </span><span class="err">set</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">v</span><span class="mi">3</span><span class="w"> </span><span class="err">API.</span><span class="w">
     </span><span class="err">*/</span><span class="w">
    </span><span class="err">public</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">getPublicJsonWebKeySet()</span><span class="w"> </span><span class="err">throws</span><span class="w"> </span><span class="err">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">HttpClient</span><span class="w"> </span><span class="err">httpClient</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">HttpClient.newHttpClient();</span><span class="w">
        </span><span class="err">HttpRequest</span><span class="w"> </span><span class="err">request</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">HttpRequest.newBuilder(URI.create(</span><span class="s2">"https://identity.constantcontact.com/oauth2/aus1lm3ry9mF7x2Ja0h8/v1/keys"</span><span class="err">))</span><span class="w">
                </span><span class="err">.GET()</span><span class="w">
                </span><span class="err">.header(</span><span class="s2">"Accept"</span><span class="p">,</span><span class="s2">"application/json"</span><span class="err">)</span><span class="w">
                </span><span class="err">.header(</span><span class="s2">"Content-Type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"application/x-www-form-urlencoded"</span><span class="err">)</span><span class="w">
                </span><span class="err">.build();</span><span class="w">
        </span><span class="err">HttpResponse&lt;String&gt;</span><span class="w"> </span><span class="err">httpResponse</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">httpClient.send(request</span><span class="p">,</span><span class="w"> </span><span class="err">HttpResponse.BodyHandlers.ofString());</span><span class="w">

        </span><span class="err">return</span><span class="w"> </span><span class="err">httpResponse.body();</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h2 id="verify-the-access-token-claims">Verify the Access Token Claims</h2>

<p>Use the method that follows to parse the access token, and then validate the signature and claims of the access token. The code examples in this step use the <code class="highlighter-rouge">org.jose4j</code> library.</p>

<p>Use the <code class="highlighter-rouge">jwt</code> parameter to pass in the access token. Use the <code class="highlighter-rouge">jsonWebKeySetJson</code> parameter to pass the JSON Web Key Set (JWKS) value that was returned in the previous step (Load the JSON web-key set to get the access token).</p>

<p>If the access token is not valid or if a required claim is missing or incorrect, an exception occurs.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">    </span><span class="err">/**</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">method</span><span class="w"> </span><span class="err">uses</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">jose</span><span class="mi">4</span><span class="err">j</span><span class="w"> </span><span class="err">library</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">verify</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">claims</span><span class="w"> </span><span class="err">on</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">JWT.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">It</span><span class="w"> </span><span class="err">throws</span><span class="w"> </span><span class="err">an</span><span class="w"> </span><span class="err">exception</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">it</span><span class="w"> </span><span class="err">fails</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">parse</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">JWT,</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">JWT</span><span class="w"> </span><span class="err">does</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">include</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">expected</span><span class="w"> </span><span class="err">claim.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">jwt</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">containing</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">web</span><span class="w"> </span><span class="err">token.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">jsonWebKeySetJson</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">set</span><span class="w"> </span><span class="err">of</span><span class="w"> </span><span class="err">keys</span><span class="w"> </span><span class="err">available</span><span class="w"> </span><span class="err">at</span><span class="w"> </span><span class="err">https://identity.constantcontact.com/oauth</span><span class="mi">2</span><span class="err">/aus</span><span class="mi">1</span><span class="err">lm</span><span class="mi">3</span><span class="err">ry</span><span class="mi">9</span><span class="err">mF</span><span class="mi">7</span><span class="err">x</span><span class="mi">2</span><span class="err">Ja</span><span class="mi">0</span><span class="err">h</span><span class="mi">8</span><span class="err">/v</span><span class="mi">1</span><span class="err">/keys</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@throws</span><span class="w"> </span><span class="err">JoseException</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@throws</span><span class="w"> </span><span class="err">InvalidJwtException</span><span class="w">
     </span><span class="err">*/</span><span class="w">
    </span><span class="err">public</span><span class="w"> </span><span class="err">void</span><span class="w"> </span><span class="err">verifyJwtToken(String</span><span class="w"> </span><span class="err">jwt,</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">jsonWebKeySetJson)</span><span class="w"> </span><span class="err">throws</span><span class="w"> </span><span class="err">JoseException,</span><span class="w"> </span><span class="err">InvalidJwtException</span><span class="w"> </span><span class="p">{</span><span class="w">

        </span><span class="err">JsonWebKeySet</span><span class="w"> </span><span class="err">jsonWebKeySet</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">JsonWebKeySet(jsonWebKeySetJson);</span><span class="w">
        </span><span class="err">VerificationJwkSelector</span><span class="w"> </span><span class="err">jwkSelector</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">VerificationJwkSelector();</span><span class="w">
        </span><span class="err">JsonWebSignature</span><span class="w"> </span><span class="err">jws</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">JsonWebSignature();</span><span class="w">
        </span><span class="err">jws.setCompactSerialization(jwt);</span><span class="w">

        </span><span class="err">JsonWebKey</span><span class="w"> </span><span class="err">jwk</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">jwkSelector.select(jws</span><span class="p">,</span><span class="w"> </span><span class="err">jsonWebKeySet.getJsonWebKeys());</span><span class="w">

        </span><span class="err">JwtConsumer</span><span class="w"> </span><span class="err">jwtConsumer</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">JwtConsumerBuilder()</span><span class="w">
                </span><span class="err">.setRequireExpirationTime()</span><span class="w">
                </span><span class="err">.setRequireSubject()</span><span class="w">
                </span><span class="err">.setExpectedIssuer(</span><span class="s2">"https://identity.constantcontact.com/oauth2/aus1lm3ry9mF7x2Ja0h8"</span><span class="err">)</span><span class="w">
                </span><span class="err">.setExpectedAudience(</span><span class="s2">"https://api.cc.email/v3"</span><span class="err">)</span><span class="w">
                </span><span class="err">.setVerificationKey(jwk.getKey())</span><span class="w">
                </span><span class="err">.setJwsAlgorithmConstraints(AlgorithmConstraints.ConstraintType.PERMIT</span><span class="p">,</span><span class="w"> </span><span class="err">AlgorithmIdentifiers.RSA_USING_SHA</span><span class="mi">256</span><span class="err">)</span><span class="w">
                </span><span class="err">.build();</span><span class="w">

        </span><span class="err">jwtConsumer.processToClaims(jwt);</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>Check the following claims:</p>
<ul>
  <li>Compare the <code class="highlighter-rouge">cid</code> (client identifier) value to ensure that it matches your application API key</li>
  <li>The <code class="highlighter-rouge">platform_user_id</code> claim in the access token uniquely identifies a Constant Contact user.</li>
</ul>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>JwtClaims claims = consumer.processToClaims(token);
     
     String cid = claims.get("cid")
     if (! apiKey.equals(cid)) {
     throw new InvalidJwtException("Api key in token incorrect");
     }
     String userId = claims.get("platform_user_id")
     
     if (userId == null) {
     throw new InvalidJwtException("Token is missing platform_user_id");
     }  
</code></pre></div></div>

<h1 id="step-6-add-the-access-token-to-the-authorization-request">Step 6: Add the Access Token to the Authorization Request</h1>

<p>After verifying the access token claims and signature, use the <code class="highlighter-rouge">access_token</code> to send requests in the V3 API by adding it to the <code class="highlighter-rouge">Authorization</code> request header in the format <code class="highlighter-rouge">Authorization: Bearer {your_access_token}</code>. When an access token expires, users must reauthorize your application with Constant Contact. Access tokens automatically expire after 1440 minutes (86,400 seconds).</p>

<p>Making an API call with an expired access token returns a 401 unauthorized status code.
  See the <a href="auth_overview.html#authorization-request-errors">Authorization Request Errors</a> table in the <em>Authorization Overview</em> for information on how to handle authorization request errors.</p>

<h1 id="step-7-optional-check-the-access-token-expiration-timestamp">Step 7 (Optional): Check the Access Token Expiration Timestamp</h1>

<p>You can quickly check to see if the access token is expired or not using the method that follows.</p>

<p>Use the <code class="highlighter-rouge">jwt</code> parameter to pass in the access token. This method returns <code class="highlighter-rouge">True</code> for an expired token if the expiration time is within 5 minutes (300 seconds) of the current time, or <code class="highlighter-rouge">False</code> if the token has not expired. If the access token expires, you can exchange it for a new access and refresh token using the <em>Refresh the Access Token</em> procedure.</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="w">  </span><span class="err">/**</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">method</span><span class="w"> </span><span class="err">checks</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">current</span><span class="w"> </span><span class="err">time</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">greater</span><span class="w"> </span><span class="err">than</span><span class="w"> </span><span class="err">or</span><span class="w"> </span><span class="err">equal</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">JWT</span><span class="w"> </span><span class="err">expiration</span><span class="w"> </span><span class="err">claim.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">jwt</span><span class="w"> </span><span class="err">A</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">web</span><span class="w"> </span><span class="err">token.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@return</span><span class="w"> </span><span class="err">True</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">jwt</span><span class="w"> </span><span class="err">token</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">expired.</span><span class="w"> </span><span class="err">False</span><span class="w"> </span><span class="err">if</span><span class="w"> </span><span class="err">the</span><span class="w"> </span><span class="err">token</span><span class="w"> </span><span class="err">is</span><span class="w"> </span><span class="err">not</span><span class="w"> </span><span class="err">expired.</span><span class="w">
     </span><span class="err">*/</span><span class="w">
    </span><span class="err">public</span><span class="w"> </span><span class="err">boolean</span><span class="w"> </span><span class="err">checkIfTokenIsExpired(String</span><span class="w"> </span><span class="err">jwt)</span><span class="w"> </span><span class="err">throws</span><span class="w"> </span><span class="err">InvalidJwtException,</span><span class="w"> </span><span class="err">MalformedClaimException</span><span class="w"> </span><span class="p">{</span><span class="w">

        </span><span class="err">JwtConsumer</span><span class="w"> </span><span class="err">jwtConsumer</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">JwtConsumerBuilder()</span><span class="w">
                </span><span class="err">.setRequireExpirationTime()</span><span class="w">
                </span><span class="err">.setSkipDefaultAudienceValidation()</span><span class="w">
                </span><span class="err">.setDisableRequireSignature()</span><span class="w">
                </span><span class="err">.setSkipSignatureVerification()</span><span class="w">
                </span><span class="err">.build();</span><span class="w">
         </span><span class="err">JwtClaims</span><span class="w"> </span><span class="err">jwtClaims</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">jwtConsumer.processToClaims(jwt);</span><span class="w">
         </span><span class="err">return</span><span class="w"> </span><span class="err">NumericDate.now().getValue()</span><span class="w"> </span><span class="err">&gt;=</span><span class="w"> </span><span class="err">jwtClaims.getExpirationTime().getValue();</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<p><strong>Example Response</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="s2">"28800"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJraWQiOiIzSDdLVVpkSDlyNTh6RVVDSzNYMlR1b2o0SjV0eldWUF9FRUxQTDd6X3hjIiwiYWxnIjoiUlMyNTYifQ.eyJ2ZXIiOjEsImp0aSI6IkFULkZ6YUUtTVFFb2dKQ1VzZlhSUGtBZldobDllckJndVlYRWphOGFXd1RyRzgiLCJpc3MiOiJodHRwczovL2lkZW50aXR5LmNvbnN0YW50Y29udGFjdC5jb20vb2F1dGgyL2F1czFsbTNyeTltRjd4MkphMGg4IiwiYXVkIjoiaHR0cHM6Ly9hcGkuY2MuZW1haWwvdjMiLCJpYXQiOjE2NDQ0Mjc3NzMsImV4cCI6MTY0NDQ1NjU3MywiY2lkIjoiY2M5NGMyZDYtNmU3MC00MjZjLWFmZDEtNzFjOGZhNWY0ODkwIiwidWlkIjoiMDB1MWlieDhsaGIzYW12SFIwaDgiLCJzY3AiOlsiYWNjb3VudF9yZWFkIiwiZW1haWwiLCJjYW1wYWlnbl9kYXRhIiwicHJvZmlsZSIsImFkZHJlc3MiLCJjb250YWN0X2RhdGEiLCJvcGVuaWQiXSwic3ViIjoiZ2Vla3NxdWFkIiwicGxhdGZvcm1fdXNlcl9pZCI6ImQzYTA2ZTYyLTJmMTQtNGQ5Ni05NDUzLTI2NTkxYWI1M2YwZCJ9.saJxgUYx1_OKUteH01KV71vzjaxqTKnZ3XfD4QKtsIkjrmcf4tUWEFSzjuF1kdxLvlMoCyr_MwO81ApwYX2UU0YRhkVsfw2VLR4KpO89ILul7ZJZyzzsVKak8BrgLhqR1AB7X116VRjsH74vD4D-1e4uKKUlK4yefsZE14kFgDZNi74_WPn5FBGeicwMsStdG3qms8X-6LqIxuZ5fXgSxK9wDEBe-xJfJSqAqo1vJKMqw2JT_NvBBLDXqoSg0_q_0IqbxXEMHdX2J_DHGKrY7w1QQGmeBU_BIlewQPUxUGX-dbRavxncBpItt1tsRLBIiPbPkQ_zDN8_J9lPIxJksA"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account_read offline_access"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s8Mu4hfiwmug7ru4Rcoo4hjkawiw4OUTH2ixvsy3b8"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<h1 id="step-8-optional-refresh-the-access-token">Step 8 (Optional): Refresh the Access Token</h1>

<p>To avoid having a user reauthenticate and reauthorize your application with Constant Contact, use the refresh token to get a new access token and a new refresh token. To refresh the access token, send a POST request to the <code class="highlighter-rouge">https://authz.constantcontact.com/oauth2/default/v1/token</code> authorization endpoint.</p>

<p>Constant Contact rate limits the token endpoint. A 429 response will likely be returned if you attempt to refresh an access token before every V3 API request. Constant Contact recommends that you only send a refresh token request to get a new access token if your existing access token is expired or about to expire.</p>

<p><strong>Request parameters</strong></p>

<ul>
  <li>
    <p><strong><code class="highlighter-rouge">refresh_token</code></strong> — <em>Required</em>. The refresh token that corresponds to the access token you are trying to refresh.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">grant_type</code></strong> — <em>Required</em>. The value is <code class="highlighter-rouge">refresh_token</code>. This specifies that the purpose of this request is to refresh an access token.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">redirect_uri</code></strong> — <em>Required</em>. Enter the redirect URI that was used as part of the authorization request URL.</p>
  </li>
</ul>

<p><strong>Header Formats</strong></p>

<p>In the header, specify the preferred response formats to return as follows:</p>
<ul>
  <li><code class="highlighter-rouge">"Accept", "application/json"</code></li>
  <li><code class="highlighter-rouge">"Content-Type", "application/x-www-form-urlencoded"</code></li>
</ul>

<p><strong>Example Request</strong></p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="err">/**</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">This</span><span class="w"> </span><span class="err">method</span><span class="w"> </span><span class="err">exchanges</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">refresh</span><span class="w"> </span><span class="err">token</span><span class="w"> </span><span class="err">for</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">access</span><span class="w"> </span><span class="err">token</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">bearer</span><span class="w"> </span><span class="err">token.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">clientId</span><span class="w"> </span><span class="err">Your</span><span class="w"> </span><span class="err">application's</span><span class="w"> </span><span class="err">client</span><span class="w"> </span><span class="err">id.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">refreshToken</span><span class="w"> </span><span class="err">A</span><span class="w"> </span><span class="err">refresh</span><span class="w"> </span><span class="err">token.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@param</span><span class="w"> </span><span class="err">redirectUri</span><span class="w"> </span><span class="err">URI</span><span class="w"> </span><span class="err">used</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">redirect</span><span class="w"> </span><span class="err">users</span><span class="w"> </span><span class="err">to</span><span class="w"> </span><span class="err">your</span><span class="w"> </span><span class="err">application</span><span class="w"> </span><span class="err">after</span><span class="w"> </span><span class="err">they</span><span class="w"> </span><span class="err">complete</span><span class="w"> </span><span class="err">authorization.</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@return</span><span class="w"> </span><span class="err">A</span><span class="w"> </span><span class="err">JSON</span><span class="w"> </span><span class="err">object</span><span class="w"> </span><span class="err">containing</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">access</span><span class="w"> </span><span class="err">token</span><span class="w"> </span><span class="err">and</span><span class="w"> </span><span class="err">a</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">bearer</span><span class="w"> </span><span class="err">token</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@throws</span><span class="w"> </span><span class="err">URISyntaxException</span><span class="w">
     </span><span class="err">*</span><span class="w"> </span><span class="err">@throws</span><span class="w"> </span><span class="err">IOException</span><span class="w">
     </span><span class="err">*/</span><span class="w">
    </span><span class="err">public</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">refreshPKCEAccessToken(String</span><span class="w"> </span><span class="err">clientId,</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">refreshToken,</span><span class="w"> </span><span class="err">String</span><span class="w"> </span><span class="err">redirectUri)</span><span class="w"> </span><span class="err">throws</span><span class="w"> </span><span class="err">URISyntaxException,</span><span class="w"> </span><span class="err">IOException</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="err">URI</span><span class="w"> </span><span class="err">pkceTokenRefreshUri</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">new</span><span class="w"> </span><span class="err">URIBuilder(</span><span class="s2">"https://authz.constantcontact.com/oauth2/default/v1/token"</span><span class="err">)</span><span class="w">
                </span><span class="err">.addParameter(</span><span class="s2">"client_id"</span><span class="p">,</span><span class="w"> </span><span class="err">clientId)</span><span class="w">
                </span><span class="err">.addParameter(</span><span class="s2">"redirect_uri"</span><span class="p">,</span><span class="w"> </span><span class="err">redirectUri)</span><span class="w">
                </span><span class="err">.addParameter(</span><span class="s2">"refresh_token"</span><span class="p">,</span><span class="w"> </span><span class="err">refreshToken)</span><span class="w">
                </span><span class="err">.addParameter(</span><span class="s2">"grant_type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"refresh_token"</span><span class="err">)</span><span class="w">
                </span><span class="err">.build();</span><span class="w">
        </span><span class="err">HttpClient</span><span class="w"> </span><span class="err">httpClient</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">HttpClient.newHttpClient();</span><span class="w">
        </span><span class="err">HttpRequest</span><span class="w"> </span><span class="err">request</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">HttpRequest.newBuilder(pkceTokenRefreshUri)</span><span class="w">
                </span><span class="err">.POST(HttpRequest.BodyPublishers.ofString(</span><span class="s2">""</span><span class="err">))</span><span class="w">
                </span><span class="err">.header(</span><span class="s2">"Accept"</span><span class="p">,</span><span class="s2">"application/json"</span><span class="err">)</span><span class="w">
                </span><span class="err">.header(</span><span class="s2">"Content-Type"</span><span class="p">,</span><span class="w"> </span><span class="s2">"application/x-www-form-urlencoded"</span><span class="err">)</span><span class="w">
                </span><span class="err">.build();</span><span class="w">
        </span><span class="err">HttpResponse&lt;String&gt;</span><span class="w"> </span><span class="err">httpResponse</span><span class="w"> </span><span class="err">=</span><span class="w"> </span><span class="err">httpClient.send(request</span><span class="p">,</span><span class="w"> </span><span class="err">HttpResponse.BodyHandlers.ofString());</span><span class="w">
 
        </span><span class="err">return</span><span class="w"> </span><span class="err">httpResponse.body();</span><span class="w">
    </span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p><strong>Example Response</strong></p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
  </span><span class="nl">"token_type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bearer"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"expires_in"</span><span class="p">:</span><span class="w"> </span><span class="s2">"28800"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"access_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"eyJraWQiOiIzSDdLVVpkSDlyNTh6RVVDSzNYMlR1b2o0SjV0eldWUF9FRUxQTDd6X3hjIiwiYWxnIjoiUlMyNTYifQ.eyJ2ZXIiOjEsImp0aSI6IkFULkZ6YUUtTVFFb2dKQ1VzZlhSUGtBZldobDllckJndVlYRWphOGFXd1RyRzgiLCJpc3MiOiJodHRwczovL2lkZW50aXR5LmNvbnN0YW50Y29udGFjdC5jb20vb2F1dGgyL2F1czFsbTNyeTltRjd4MkphMGg4IiwiYXVkIjoiaHR0cHM6Ly9hcGkuY2MuZW1haWwvdjMiLCJpYXQiOjE2NDQ0Mjc3NzMsImV4cCI6MTY0NDQ1NjU3MywiY2lkIjoiY2M5NGMyZDYtNmU3MC00MjZjLWFmZDEtNzFjOGZhNWY0ODkwIiwidWlkIjoiMDB1MWlieDhsaGIzYW12SFIwaDgiLCJzY3AiOlsiYWNjb3VudF9yZWFkIiwiZW1haWwiLCJjYW1wYWlnbl9kYXRhIiwicHJvZmlsZSIsImFkZHJlc3MiLCJjb250YWN0X2RhdGEiLCJvcGVuaWQiXSwic3ViIjoiZ2Vla3NxdWFkIiwicGxhdGZvcm1fdXNlcl9pZCI6ImQzYTA2ZTYyLTJmMTQtNGQ5Ni05NDUzLTI2NTkxYWI1M2YwZCJ9.saJxgUYx1_OKUteH01KV71vzjaxqTKnZ3XfD4QKtsIkjrmcf4tUWEFSzjuF1kdxLvlMoCyr_MwO81ApwYX2UU0YRhkVsfw2VLR4KpO89ILul7ZJZyzzsVKak8BrgLhqR1AB7X116VRjsH74vD4D-1e4uKKUlK4yefsZE14kFgDZNi74_WPn5FBGeicwMsStdG3qms8X-6LqIxuZ5fXgSxK9wDEBe-xJfJSqAqo1vJKMqw2JT_NvBBLDXqoSg0_q_0IqbxXEMHdX2J_DHGKrY7w1QQGmeBU_BIlewQPUxUGX-dbRavxncBpItt1tsRLBIiPbPkQ_zDN8_J9lPIxJksA"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"scope"</span><span class="p">:</span><span class="w"> </span><span class="s2">"account_read offline_access"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"refresh_token"</span><span class="p">:</span><span class="w"> </span><span class="s2">"s8Mu4hfiwmug7ru4Rcoo4hjkawiw4OUTH2ixvsy3b8"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>
<ul>
  <li>
    <p><strong><code class="highlighter-rouge">token_type</code></strong> — The value is always set to <code class="highlighter-rouge">Bearer</code>.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">expires_in</code></strong> - The <code class="highlighter-rouge">access_token</code> expiration timestamp, in seconds.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">access_token</code></strong> — The response body returns a new <code class="highlighter-rouge">access_token</code> value.</p>
  </li>
  <li>
    <p><strong><code class="highlighter-rouge">refresh_token</code></strong> — The response body returns a new <code class="highlighter-rouge">refresh_token</code> value.</p>
  </li>
</ul>


    <script src="https://static.ctctcdn.com/h/fed-framework/1.3.0/fed.min.js"></script>

    <script type="text/javascript">
    $(".js-tab").fedTab();
    </script>


    <div class="tags">
        
        <b>Tags: </b>
        
        
        
        <a href="https://developer.constantcontact.com/api_guide/tag_OAuth2.html"  style="text-transform: none;"class="Badge Badge--teal" role="button" data-qe-id="tag-OAuth2-link">OAuth2</a>
        
        
        
        <a href="https://developer.constantcontact.com/api_guide/tag_Authorization.html"  style="text-transform: none;"class="Badge Badge--teal" role="button" data-qe-id="tag-Authorization-link">Authorization</a>
        
        
        
        <a href="https://developer.constantcontact.com/api_guide/tag_Authentication.html"  style="text-transform: none;"class="Badge Badge--teal" role="button" data-qe-id="tag-Authentication-link">Authentication</a>
        
        
        
        <a href="https://developer.constantcontact.com/api_guide/tag_PKCE_Flow.html"  style="text-transform: none;"class="Badge Badge--teal" role="button" data-qe-id="tag-PKCE-Flow-link">PKCE_Flow</a>
        
        
        
        <a href="https://developer.constantcontact.com/api_guide/tag_Implicit_Flow.html"  style="text-transform: none;"class="Badge Badge--teal" role="button" data-qe-id="tag-Implicit-Flow-link">Implicit_Flow</a>
        
        
        
        <a href="https://developer.constantcontact.com/api_guide/tag_Authorization_Code_Flow.html"  style="text-transform: none;"class="Badge Badge--teal" role="button" data-qe-id="tag-Authorization-Code-Flow-link">Authorization_Code_Flow</a>
        
        
        
        <a href="https://developer.constantcontact.com/api_guide/tag_scopes.html"  style="text-transform: none;"class="Badge Badge--teal" role="button" data-qe-id="tag-scopes-link">scopes</a>
        
        
        
    </div>

</div>

<div class="shaded"/>

                </div>
            </div>

        </section>

        <dev-portal-footer></dev-portal-footer>


    </div>

</body>

</html>
